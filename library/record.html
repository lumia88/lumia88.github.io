<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Document</title>
  </head>
  <body>
    <h2>语音输入</h2>
    <input
      type="text"
      speech
      x-webkit-speech="”x-webkit-speech”"
      onwebkitspeechchange="alert(this.value)"
    />
    <h3>语音获取</h3>
    <button onclick="getAudio()">捕获语音</button>
  </body>
  <script>
    function getAudio() {
      console.log("start get audio...");
      const audio = document.createElement("audio");
      audio.id = "record-demo";
      audio.width = "380px";
      audio.height = "80px";

      const constraints = {
        audio: true,
        video: false,
      };

      navigator.mediaDevices
        .getUserMedia(constraints)
        .then((stream) => {
          console.log("recording...");
          const audioTracks = stream.getAudioTracks();
          console.log("Got stream with constraints:", constraints);
          console.log(`Using audio device: ${audioTracks[0].label}`);
          stream.onremovetrack = () => {
            console.log("Stream ended");
          };
          try {
            audio.srcObject = stream;

            console.log("___audio_stream___", audio.srcObject);
            console.log("___audio___", audio);
          } catch (error) {
            audio.src = window.URL.createObjectURL(stream);
            console.log("___audio_stream_src___", audio.src);
            console.error(error);
          }
        }).then(() => {
            document.body.appendChild(audio);
        })
        .catch((error) => {
          if (error.name === "OverconstrainedError") {
            console.error(
              `The resolution ${constraints.audio.width.exact}x${constraints.audio.height.exact} px is not supported by your device.`
            );
          } else if (error.name === "NotAllowedError") {
            console.error(
              "You need to grant this page permission to access your camera and microphone."
            );
          } else {
            console.error(`getUserMedia error: ${error.name}`, error);
          }
        });
    }
  </script>
</html>
